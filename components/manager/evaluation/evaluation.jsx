"use client";

import React, { useState } from 'react';

/*
 This code generated by CHATGPT 4.0
 Then made edits to correspond with css
*/

export default function Evaluation({ scheduleData }) {
  const [selectedEmployee, setSelectedEmployee] = useState('');
  const [selectedDays, setSelectedDays] = useState([]);
  const [totalHours, setTotalHours] = useState(0);

  const handleEmployeeChange = (e) => {
    setSelectedEmployee(e.target.value);
    setTotalHours(0);
  };

  const handleDaySelection = (dayIndex) => {
    setSelectedDays(prev =>
      prev.includes(dayIndex) ? prev.filter(d => d !== dayIndex) : [...prev, dayIndex]
    );
    setTotalHours(0);
  };

  const handleSelectAll = () => {
    if (selectedDays.length === weekDays.length) {
      setSelectedDays([]);
    } else {
      setSelectedDays(weekDays.map((_, index) => index));
    }
    setTotalHours(0);
  };

  const calculateShiftHours = () => {
    let hours = 0;
    selectedDays.forEach(day => {
      scheduleData.schedule[weekDays[day]].shifts.forEach(shift => {
        if (shift.employee === selectedEmployee) {
          hours += shift.hours;
        }
      });
    });
    setTotalHours(hours);
  };

  const weekDays = ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"];

  return (
    <div className="flex flex-col items-center justify-center h-[50vh] relative">
      <div className="bg-black p-8 rounded-md text-center text-white shadow-md max-w-[90%] border border-gray-300">
        <div className="mb-5">
          <label htmlFor="employeeName" className="block mb-2">Employee Name:</label>
          <select id="employeeName" value={selectedEmployee} onChange={handleEmployeeChange}>
            <option value="">Select an employee</option>
             {/* Using Set to ensure unique employee names and mapping to options */}
             {[...new Set(scheduleData.schedule.flatMap(day => day.shifts.map(shift => shift.employee)))].map(name => (
              <option key={name} value={name}>{name}</option>
            ))}
          </select>
        </div>
        <div className="mt-10 flex flex-wrap justify-center">
          <label className="w-full mb-2">Select Days:</label>
          {weekDays.map((day, index) => (
            <div key={index} className="flex-none mb-2 mr-2">
              <button
                type="button"
                className={`bg-white border-none text-black text-lg p-2 m-1 cursor-pointer rounded ${selectedDays.includes(index) ? 'bg-blue-600 text-white' : ''}`}
                onClick={() => handleDaySelection(index)}
              >
                {day.slice(0, 3)}
              </button>
            </div>
          ))}
          <div className="flex-none mb-2 mr-2">
            <button
              type="button"
              className="bg-white border-none text-black text-lg p-2 m-1 cursor-pointer rounded hover:bg-blue-600"
              onClick={handleSelectAll}
            >
              {selectedDays.length === weekDays.length ? 'Unselect All' : 'Select All'}
            </button>
          </div>
        </div>
        <button
          className="p-2 mt-5 bg-white text-black border-none cursor-pointer text-lg rounded hover:bg-blue-600"
          onClick={calculateShiftHours}
        >
          Calculate Shift Hours
        </button>
      </div>
      {totalHours > 0 && (
        <div className="bg-gray-700 border border-gray-300 rounded-md p-5 mt-5 shadow-md w-[450px]">
          <h2 className="font-bold mb-3">Employee Hours</h2>
          <p>Employee: {selectedEmployee}</p>
          <p>Total Hours: {totalHours}</p>
        </div>
      )}
    </div>
  );
}
